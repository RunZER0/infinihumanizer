{% extends "base.html" %}

{% block title %}Device Management - InfiniHumanizer{% endblock %}

{% block content %}

<style>
    /* Reset base.html styles */
    body {
        background: #0D0D0D !important;
        margin: 0;
        padding: 0;
        font-family: 'Aptos', 'Segoe UI', sans-serif;
    }
    
    main {
        padding: 0 !important;
        margin: 0 !important;
    }
    
    /* Hide base navigation */
    nav {
        display: none !important;
    }
    
    /* Modern Top Ribbon */
    .top-ribbon {
        background: linear-gradient(135deg, rgba(0, 0, 0, 0.95), rgba(26, 26, 26, 0.95));
        border-bottom: 1px solid rgba(0, 212, 255, 0.3);
        padding: 1rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        backdrop-filter: blur(10px);
        position: sticky;
        top: 0;
        z-index: 100;
    }
    
    .ribbon-left {
        display: flex;
        align-items: center;
        gap: 1.5rem;
    }
    
    .app-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: #00D4FF;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .ribbon-right {
        display: flex;
        gap: 1rem;
        align-items: center;
    }
    
    .back-btn {
        background: rgba(0, 212, 255, 0.1);
        border: 1px solid rgba(0, 212, 255, 0.3);
        color: #00D4FF;
        padding: 0.5rem 1.2rem;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .back-btn:hover {
        background: rgba(0, 212, 255, 0.2);
        transform: translateX(-3px);
    }
    
    /* Main Container */
    .devices-container {
        min-height: calc(100vh - 80px);
        background: linear-gradient(180deg, #0D0D0D 0%, #1a1a2e 50%, #0D0D0D 100%);
        padding: 3rem 2rem;
    }
    
    .content-wrapper {
        max-width: 1200px;
        margin: 0 auto;
    }
    
    /* Header */
    .page-header {
        margin-bottom: 3rem;
    }
    
    .page-header h1 {
        font-size: 2.5rem;
        color: #FFF;
        font-weight: 800;
        margin-bottom: 0.5rem;
    }
    
    .page-header p {
        color: rgba(255, 255, 255, 0.5);
        font-size: 1.1rem;
    }
    
    /* Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-bottom: 3rem;
    }
    
    .stat-card {
        background: rgba(0, 0, 0, 0.4);
        border: 1px solid rgba(0, 212, 255, 0.2);
        border-radius: 16px;
        padding: 2rem;
        display: flex;
        align-items: center;
        gap: 1.5rem;
        transition: all 0.3s ease;
    }
    
    .stat-card:hover {
        border-color: rgba(0, 212, 255, 0.5);
        transform: translateY(-3px);
        box-shadow: 0 8px 30px rgba(0, 212, 255, 0.15);
    }
    
    .stat-icon {
        font-size: 2.5rem;
        width: 70px;
        height: 70px;
        background: rgba(0, 212, 255, 0.1);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .stat-content {
        flex: 1;
    }
    
    .stat-value {
        font-size: 2.2rem;
        color: #00D4FF;
        font-weight: 800;
        line-height: 1;
        margin-bottom: 0.5rem;
    }
    
    .stat-label {
        color: rgba(255, 255, 255, 0.6);
        font-size: 0.95rem;
        font-weight: 500;
    }
    
    /* Section Header */
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }
    
    .section-title {
        font-size: 1.8rem;
        color: #00D4FF;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    /* Device List */
    .device-list {
        background: rgba(0, 0, 0, 0.4);
        border: 1px solid rgba(0, 212, 255, 0.2);
        border-radius: 16px;
        overflow: hidden;
    }
    
    .device-item {
        padding: 1.5rem 2rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        display: grid;
        grid-template-columns: auto 1fr auto auto;
        gap: 1.5rem;
        align-items: center;
        transition: all 0.3s ease;
    }
    
    .device-item:last-child {
        border-bottom: none;
    }
    
    .device-item:hover {
        background: rgba(0, 212, 255, 0.05);
    }
    
    .device-item.current-device {
        background: rgba(0, 212, 255, 0.08);
        border-left: 3px solid #00D4FF;
    }
    
    .device-icon-box {
        width: 60px;
        height: 60px;
        background: rgba(0, 212, 255, 0.1);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
    }
    
    .device-info {
        flex: 1;
        min-width: 0;
    }
    
    .device-name {
        font-size: 1.1rem;
        font-weight: 700;
        color: #FFF;
        margin-bottom: 0.3rem;
    }
    
    .device-details {
        display: flex;
        gap: 1.5rem;
        flex-wrap: wrap;
    }
    
    .device-detail-item {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        font-size: 0.85rem;
        color: rgba(255, 255, 255, 0.5);
    }
    
    .device-detail-item span:first-child {
        color: rgba(255, 255, 255, 0.3);
    }
    
    .status-badge {
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        white-space: nowrap;
    }
    
    .status-active {
        background: rgba(0, 255, 136, 0.15);
        color: #00FF88;
        border: 1px solid rgba(0, 255, 136, 0.3);
    }
    
    .status-inactive {
        background: rgba(255, 255, 255, 0.05);
        color: rgba(255, 255, 255, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .current-badge {
        background: rgba(0, 212, 255, 0.15);
        color: #00D4FF;
        padding: 0.3rem 0.8rem;
        border-radius: 6px;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .no-devices {
        text-align: center;
        padding: 4rem 2rem;
        color: rgba(255, 255, 255, 0.4);
    }
    
    .no-devices-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.3;
    }
    
    /* Info Banner */
    .info-banner {
        background: rgba(0, 212, 255, 0.05);
        border: 1px solid rgba(0, 212, 255, 0.2);
        border-radius: 16px;
        padding: 2rem;
        margin-top: 2rem;
    }
    
    .info-banner h3 {
        color: #00D4FF;
        font-size: 1.2rem;
        font-weight: 700;
        margin-bottom: 1rem;
    }
    
    .info-banner ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .info-banner li {
        padding: 0.5rem 0;
        color: rgba(255, 255, 255, 0.6);
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
        font-size: 0.95rem;
    }
    
    .info-banner li::before {
        content: '‚Ä¢';
        color: #00D4FF;
        font-weight: 900;
        font-size: 1.2rem;
        line-height: 1.5;
    }
</style>

<!-- Modern Top Ribbon -->
<div class="top-ribbon">
    <div class="ribbon-left">
        <div class="app-title">
            <span>üì±</span>
            <span>Device Management</span>
        </div>
    </div>
    <div class="ribbon-right">
        <a href="{% url 'humanizer' %}" class="back-btn">
            <span>‚Üê</span>
            <span>Back to Humanizer</span>
        </a>
    </div>
</div>

<div class="devices-container">
    <div class="content-wrapper">
        <!-- Page Header -->
        <div class="page-header">
            <h1>üì± Device Management</h1>
            <p>Monitor and manage your active sessions</p>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üì±</div>
                <div class="stat-content">
                    <div class="stat-value">{{ active_count }} / {{ max_concurrent }}</div>
                    <div class="stat-label">Active Sessions</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìÖ</div>
                <div class="stat-content">
                    <div class="stat-value">{{ devices_today }} / {{ max_daily }}</div>
                    <div class="stat-label">Devices Used Today</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üíé</div>
                <div class="stat-content">
                    <div class="stat-value">{{ profile.account_type }}</div>
                    <div class="stat-label">Current Plan</div>
                </div>
            </div>
        </div>

        <!-- Device List -->
        <div class="section-header">
            <h2 class="section-title">
                <span>üñ•Ô∏è</span>
                <span>Your Devices</span>
            </h2>
        </div>

        <div class="device-list">
            {% if all_sessions %}
                {% for session in all_sessions %}
                <div class="device-item {% if session.device_fingerprint == current_device_fingerprint %}current-device{% endif %}">
                    <div class="device-icon-box">
                        {% if 'Mobile' in session.user_agent or 'Android' in session.user_agent or 'iPhone' in session.user_agent %}
                            üì±
                        {% else %}
                            üíª
                        {% endif %}
                    </div>
                    
                    <div class="device-info">
                        <div class="device-name">
                            {% if 'Windows' in session.user_agent %}
                                Windows PC
                            {% elif 'Macintosh' in session.user_agent or 'Mac OS' in session.user_agent %}
                                Mac Computer
                            {% elif 'Android' in session.user_agent %}
                                Android Device
                            {% elif 'iPhone' in session.user_agent or 'iPad' in session.user_agent %}
                                iOS Device
                            {% elif 'Linux' in session.user_agent %}
                                Linux Computer
                            {% else %}
                                Unknown Device
                            {% endif %}
                        </div>
                        <div class="device-details">
                            <div class="device-detail-item">
                                <span>IP:</span>
                                <span>{{ session.ip_address }}</span>
                            </div>
                            <div class="device-detail-item">
                                <span>Last Seen:</span>
                                <span>{{ session.last_seen|timesince }} ago</span>
                            </div>
                            <div class="device-detail-item">
                                <span>First Used:</span>
                                <span>{{ session.created_at|date:"M d, Y" }}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        {% if session.is_active and session.last_seen >= active_threshold %}
                            <span class="status-badge status-active">‚óè Online</span>
                        {% else %}
                            <span class="status-badge status-inactive">‚óè Offline</span>
                        {% endif %}
                    </div>
                    
                    <div>
                        {% if session.device_fingerprint == current_device_fingerprint %}
                            <span class="current-badge">This Device</span>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="no-devices">
                    <div class="no-devices-icon">üì±</div>
                    <p>No devices found</p>
                </div>
            {% endif %}
        </div>

        <!-- Info Banner -->
        <div class="info-banner">
            <h3>‚ÑπÔ∏è Device Limits</h3>
            <ul>
                {% if profile.account_type == 'KE_MULTI_DEVICE' %}
                    <li>Multi-Device Plan: Up to {{ max_concurrent }} devices can be active simultaneously</li>
                    <li>Daily limit: {{ max_daily }} unique devices per day</li>
                    <li>Your devices automatically sync across sessions</li>
                {% else %}
                    <li>Your plan allows {{ max_concurrent }} active device at a time</li>
                    <li>Daily limit: {{ max_daily }} unique devices per day</li>
                    <li>Logging in from a new device will logout the previous one</li>
                    <li>Upgrade to Multi-Device plan for simultaneous access</li>
                {% endif %}
            </ul>
        </div>
    </div>
</div>

{% endblock %}
